import{O as D,r as s,P as $,Q as v,m as c,y as g,S as E,D as n}from"./index-bbf8b0ea.js";import{l as z}from"./loadUserGuilds-9c6c8c8e.js";const P=D("discordGuild",()=>{const e=s(),l=s(),i=s(),t=s(!1);async function p(r){try{const a=await z();console.log(a);const o=a.find(S=>S.id==r);if(console.log(o),!o)throw new Error(`Cannot load discord guild. Guild with id ${r} does not exist in user guilds list.`);const u=await $.get(`/api/discord/guilds/${r}/channels`,{headers:{Authorization:v("bot")}});return i.value={...o,channels:u.data},i.value}catch(a){return console.error(a),c().addError("Oops. Something went wrong and we cannot load discord guild. Please try again"),!1}}async function d(r){t.value=!0;try{const a=await g.get(`/api/discord/guilds/${r}`,{headers:{Authorization:`Bearer ${E().rawToken}`}});t.value=!1;const o=n.cloneDeep(a.data);return o.module_general||(o.module_general={}),e.value=o,e.value}catch{return t.value=!1,c().addError("Oops. Something went wrong and we cannot load guild from bot server. Please try again"),!1}}async function h(r){return e.value&&!t.value?e:r?await d(r):!1}async function w(){if(!e.value||!l.value)return!1;if(!n.isEqual(l.value,e.value))try{return await g.put(`/api/discord/guilds/${e.value.id}`,e.value,{headers:{Authorization:v("bot")}}),l.value=n.cloneDeep(e.value),e.value}catch{return c().addError("Oops. Somwhthing went wrong while syncing guild. Please try again."),!1}}function y(){return!e.value||!l.value?!1:(e.value=n.cloneDeep(l.value),e.value)}function f(r,a){if(!e.value)return!1;l.value||(l.value=n.cloneDeep(e.value)),e.value[`module_${r}`]=n.cloneDeep(a)}function G(r,a,o){if(!e.value)return!1;const u=n.cloneDeep(e.value[`module_${r}`])||{};return u[a]=n.cloneDeep(o),f(r,u)}async function m(r){var u;if(!((u=e.value)!=null&&u.id))return!1;const a=await d(e.value.id);return a?a[`module_${r}`]:!1}return{guild:e,loading:t,oldGuild:l,discordGuild:i,loadDiscordGuild:p,loadGuild:d,getGuild:h,updateModule:f,updateModuleProperty:G,loadModule:m,syncGuild:w,resetGuildChanges:y}});export{P as useDiscordGuildStore};
