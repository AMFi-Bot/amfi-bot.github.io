import{d as D,i as $,j as v,u as c,b as g,f as E,_ as n}from"./jwt-dc6be0b0.js";import{l as z}from"./loadUserGuilds-62d26ffa.js";import{p as s}from"./runtime-core.esm-bundler-3e803943.js";const b=D("discordGuild",()=>{const e=s(),l=s(),i=s(),t=s(!1);async function p(r){try{const o=await z();console.log(o);const a=o.find(S=>S.id==r);if(console.log(a),!a)throw new Error(`Cannot load discord guild. Guild with id ${r} does not exist in user guilds list.`);const u=await $.get(`/api/discord/guilds/${r}/channels`,{headers:{Authorization:v("bot")}});return i.value={...a,channels:u.data},i.value}catch(o){return console.error(o),c().addError("Oops. Something went wrong and we cannot load discord guild. Please try again"),!1}}async function d(r){t.value=!0;try{const o=await g.get(`/api/discord/guilds/${r}`,{headers:{Authorization:`Bearer ${E().rawToken}`}});t.value=!1;const a=n.cloneDeep(o.data);return a.module_general||(a.module_general={}),e.value=a,e.value}catch{return t.value=!1,c().addError("Oops. Something went wrong and we cannot load guild from bot server. Please try again"),!1}}async function h(r){return e.value&&!t.value?e:r?await d(r):!1}async function w(){if(!e.value||!l.value)return!1;if(!n.isEqual(l.value,e.value))try{return await g.put(`/api/discord/guilds/${e.value.id}`,e.value,{headers:{Authorization:v("bot")}}),l.value=n.cloneDeep(e.value),e.value}catch{return c().addError("Oops. Somwhthing went wrong while syncing guild. Please try again."),!1}}function G(){return!e.value||!l.value?!1:(e.value=n.cloneDeep(l.value),e.value)}function f(r,o){if(!e.value)return!1;l.value||(l.value=n.cloneDeep(e.value)),e.value[`module_${r}`]=n.cloneDeep(o)}function m(r,o,a){if(!e.value)return!1;const u=n.cloneDeep(e.value[`module_${r}`])||{};return u[o]=n.cloneDeep(a),f(r,u)}async function y(r){var u;if(!((u=e.value)!=null&&u.id))return!1;const o=await d(e.value.id);return o?o[`module_${r}`]:!1}return{guild:e,loading:t,oldGuild:l,discordGuild:i,loadDiscordGuild:p,loadGuild:d,getGuild:h,updateModule:f,updateModuleProperty:m,loadModule:y,syncGuild:w,resetGuildChanges:G}});export{b as useDiscordGuildStore};
