import{c as $,a as z}from"./vue-router-1dd73624.js";import{a as N,d as U,u as R,g as C,b as k,e as O,f as W,s as V,l as q}from"./jwt-dc6be0b0.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";import{p as M}from"./runtime-core.esm-bundler-3e803943.js";const x="modulepreload",J=function(c){return"/"+c},G={},l=function(o,n,a){if(!n||n.length===0)return o();const g=document.getElementsByTagName("link");return Promise.all(n.map(u=>{if(u=J(u),u in G)return;G[u]=!0;const f=u.endsWith(".css"),w=f?'[rel="stylesheet"]':"";if(!!a)for(let _=g.length-1;_>=0;_--){const y=g[_];if(y.href===u&&(!f||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${w}`))return;const p=document.createElement("link");if(p.rel=f?"stylesheet":x,f||(p.as="script",p.crossOrigin=""),p.href=u,document.head.appendChild(p),f)return new Promise((_,y)=>{p.addEventListener("load",_),p.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${u}`)))})})).then(()=>o())};var D={},j={get exports(){return D},set exports(c){D=c}};/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */(function(c,o){(function(n,a){c.exports=a()})(N,function(){var n={};n.version="0.2.0";var a=n.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};n.configure=function(t){var e,r;for(e in t)r=t[e],r!==void 0&&t.hasOwnProperty(e)&&(a[e]=r);return this},n.status=null,n.set=function(t){var e=n.isStarted();t=g(t,a.minimum,1),n.status=t===1?null:t;var r=n.render(!e),s=r.querySelector(a.barSelector),d=a.speed,m=a.easing;return r.offsetWidth,w(function(i){a.positionUsing===""&&(a.positionUsing=n.getPositioningCSS()),b(s,f(t,d,m)),t===1?(b(r,{transition:"none",opacity:1}),r.offsetWidth,setTimeout(function(){b(r,{transition:"all "+d+"ms linear",opacity:0}),setTimeout(function(){n.remove(),i()},d)},d)):setTimeout(i,d)}),this},n.isStarted=function(){return typeof n.status=="number"},n.start=function(){n.status||n.set(0);var t=function(){setTimeout(function(){n.status&&(n.trickle(),t())},a.trickleSpeed)};return a.trickle&&t(),this},n.done=function(t){return!t&&!n.status?this:n.inc(.3+.5*Math.random()).set(1)},n.inc=function(t){var e=n.status;return e?(typeof t!="number"&&(t=(1-e)*g(Math.random()*e,.1,.95)),e=g(e+t,0,.994),n.set(e)):n.start()},n.trickle=function(){return n.inc(Math.random()*a.trickleRate)},function(){var t=0,e=0;n.promise=function(r){return!r||r.state()==="resolved"?this:(e===0&&n.start(),t++,e++,r.always(function(){e--,e===0?(t=0,n.done()):n.set((t-e)/t)}),this)}}(),n.render=function(t){if(n.isRendered())return document.getElementById("nprogress");_(document.documentElement,"nprogress-busy");var e=document.createElement("div");e.id="nprogress",e.innerHTML=a.template;var r=e.querySelector(a.barSelector),s=t?"-100":u(n.status||0),d=document.querySelector(a.parent),m;return b(r,{transition:"all 0 linear",transform:"translate3d("+s+"%,0,0)"}),a.showSpinner||(m=e.querySelector(a.spinnerSelector),m&&S(m)),d!=document.body&&_(d,"nprogress-custom-parent"),d.appendChild(e),e},n.remove=function(){y(document.documentElement,"nprogress-busy"),y(document.querySelector(a.parent),"nprogress-custom-parent");var t=document.getElementById("nprogress");t&&S(t)},n.isRendered=function(){return!!document.getElementById("nprogress")},n.getPositioningCSS=function(){var t=document.body.style,e="WebkitTransform"in t?"Webkit":"MozTransform"in t?"Moz":"msTransform"in t?"ms":"OTransform"in t?"O":"";return e+"Perspective"in t?"translate3d":e+"Transform"in t?"translate":"margin"};function g(t,e,r){return t<e?e:t>r?r:t}function u(t){return(-1+t)*100}function f(t,e,r){var s;return a.positionUsing==="translate3d"?s={transform:"translate3d("+u(t)+"%,0,0)"}:a.positionUsing==="translate"?s={transform:"translate("+u(t)+"%,0)"}:s={"margin-left":u(t)+"%"},s.transition="all "+e+"ms "+r,s}var w=function(){var t=[];function e(){var r=t.shift();r&&r(e)}return function(r){t.push(r),t.length==1&&e()}}(),b=function(){var t=["Webkit","O","Moz","ms"],e={};function r(i){return i.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(h,v){return v.toUpperCase()})}function s(i){var h=document.body.style;if(i in h)return i;for(var v=t.length,T=i.charAt(0).toUpperCase()+i.slice(1),E;v--;)if(E=t[v]+T,E in h)return E;return i}function d(i){return i=r(i),e[i]||(e[i]=s(i))}function m(i,h,v){h=d(h),i.style[h]=v}return function(i,h){var v=arguments,T,E;if(v.length==2)for(T in h)E=h[T],E!==void 0&&h.hasOwnProperty(T)&&m(i,T,E);else m(i,v[1],v[2])}}();function p(t,e){var r=typeof t=="string"?t:A(t);return r.indexOf(" "+e+" ")>=0}function _(t,e){var r=A(t),s=r+e;p(r,e)||(t.className=s.substring(1))}function y(t,e){var r=A(t),s;p(t,e)&&(s=r.replace(" "+e+" "," "),t.className=s.substring(1,s.length-1))}function A(t){return(" "+(t.className||"")+" ").replace(/\s+/gi," ")}function S(t){t&&t.parentNode&&t.parentNode.removeChild(t)}return n})})(j);const I=D,P=U("user",()=>{const o=M({state:"loading"});u().then(e=>o.value=e).catch(e=>{o.value={state:"unauthenticated"},console.error(e)});const n=R();function a(e){return{name:`${e.first_name} ${e.last_name}`,avatar:e.photo_url,telegramUser:e,state:"telegram"}}function g(e){var s;const r=(s=W())==null?void 0:s.accessToken;if(!r)throw new Error("accessToken cannot be null with discord user");return{name:`${e.username}`,avatar:`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.png`,discordUser:e,discordUserCredentials:{accessToken:r},state:"discord"}}async function u(){const e=C();if(!e)return{state:"unauthenticated"};if(e.userType=="Discord user"){const r=await k.get("https://discord.com/api/v10/users/@me",{headers:{Authorization:`Bearer ${e.accessToken}`}});return g(r.data)}else if(e.userType=="Telegram user"){const r=await k.get("/api/telegram/users/@me",{headers:{Authorization:`Bearer ${e.rawToken}`}});return a(r.data)}else return console.error("Invalid JWT Authorization token. Unauthenticated"),O(),{state:"unauthenticated"}}async function f(e=!1){if(!C())throw new Error("JWT Authorization token is not provided. Cannot load user.");if(o.value.state=="loading"&&!e)return await new Promise(d=>{const m=setInterval(async()=>{o.value.state!="loading"&&(clearInterval(m),d(void 0))},10)}),o.value;o.value.state="loading";const s=await u();return o.value=s,o.value}async function w(){if(o.value.state!="unauthenticated"&&o.value.state!="loading")return o.value;try{return await f()}catch(e){return S(),console.error(e),n.addError(`Something went wrong. Cannot load user:
${e!=null&&e.message?e.message:""}`),o.value}}async function b(){const e=window.open(`${{}.VITE_API_URL}/api/auth/discord/redirect`,"","width=500,height=900");if(!e)return n.addError("Cannot open popup");await new Promise(r=>{const s=setInterval(async()=>{e.closed&&(clearInterval(s),r(void 0))},500)});try{await f(!0),t()}catch(r){n.addError(`Login failed with error: 
${(r==null?void 0:r.message)??""}`)}}async function p(e){try{const r=await k.get(`/api/auth/discord/callback?${e.replace(/^\?/,"")}`);V(r.data),window.close()}catch(r){n.addError(`Something went wrong while logging ini with discord: ${(r==null?void 0:r.message)??""}`)}}async function _(e){try{const r=await k.get(`/api/auth/telegram/callback?${e.replace(/^\?/,"")}`);V(r.data),await f(!0),t()}catch(r){return n.addError(`Login failed with error: 
${(r==null?void 0:r.message)??""}`),!1}}function y(e="telegram_load"){console.log("function");const r=document.createElement("script");r.setAttribute("src","https://telegram.org/js/telegram-widget.js?19"),r.setAttribute("data-telegram-login",{}.VITE_TELEGRAM_LOGIN),r.setAttribute("data-size","large"),r.setAttribute("data-auth-url","/telegram_callback"),r.setAttribute("data-request-access","write"),r.setAttribute("data-userpic","false");const s=document.getElementsByClassName(e);for(const d in s){const m=s.item(q.toInteger(d));m&&m.replaceChildren(r)}}async function A(){return o.value.state!="unauthenticated"&&o.value.state!="loading"||(await w(),o.value.state!="unauthenticated"&&o.value.state!="loading")}function S(){O(),o.value={state:"unauthenticated"},L.push("/")}function t(){L.push("/dashboard")}return{user:o,getUser:w,reloadUser:f,login_discord:b,login_telegram:_,discord_callback:p,isAuthenticated:A,load_telegram_widget_script:y,logout:S}}),F={};function H(c,o){return"GG"}const Y=B(F,[["render",H]]),K=()=>l(()=>import("./LoadingView-6434f970.js"),["assets/LoadingView-6434f970.js","assets/LoadingView.vue_vue_type_style_index_0_lang-ae08de85.js","assets/LoadingComponent-55249104.js","assets/runtime-core.esm-bundler-3e803943.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/LoadingComponent-9b8775c8.css","assets/LoadingView-7aa1704b.css"]),Q=()=>l(()=>import("./TelegramAuth-bbbbb587.js"),["assets/TelegramAuth-bbbbb587.js","assets/LoadingView.vue_vue_type_style_index_0_lang-ae08de85.js","assets/LoadingComponent-55249104.js","assets/runtime-core.esm-bundler-3e803943.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/LoadingComponent-9b8775c8.css","assets/LoadingView-7aa1704b.css","assets/vue-router-1dd73624.js","assets/jwt-dc6be0b0.js"]),X=()=>l(()=>import("./DiscordAuth-c46eec3d.js"),["assets/DiscordAuth-c46eec3d.js","assets/LoadingView.vue_vue_type_style_index_0_lang-ae08de85.js","assets/LoadingComponent-55249104.js","assets/runtime-core.esm-bundler-3e803943.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/LoadingComponent-9b8775c8.css","assets/LoadingView-7aa1704b.css","assets/vue-router-1dd73624.js","assets/jwt-dc6be0b0.js"]),Z=()=>l(()=>import("./DiscordBotAuthCallback-8643d537.js"),["assets/DiscordBotAuthCallback-8643d537.js","assets/loginGuild-d01a31f7.js","assets/jwt-dc6be0b0.js","assets/runtime-core.esm-bundler-3e803943.js","assets/LoadingView.vue_vue_type_style_index_0_lang-ae08de85.js","assets/LoadingComponent-55249104.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/LoadingComponent-9b8775c8.css","assets/LoadingView-7aa1704b.css","assets/vue-router-1dd73624.js"]),ee=()=>l(()=>import("./DashboardView-a43c0493.js"),["assets/DashboardView-a43c0493.js","assets/loadUserGuilds-62d26ffa.js","assets/jwt-dc6be0b0.js","assets/runtime-core.esm-bundler-3e803943.js","assets/vue-router-1dd73624.js","assets/loginGuild-d01a31f7.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/DashboardView-cbdde21b.css"]);async function te(c,o,n){const a=P();if(await a.isAuthenticated()&&a.user.state=="discord")return n();n("/"),R().addError("You are not authenticated with discord.")}async function re(c,o,n){const a=P();if(await a.isAuthenticated()&&a.user.state=="telegram")return n();n("/"),R().addError("You are not authenticated with telegram.")}const L=$({history:z("/"),routes:[{path:"/",name:"root",component:Y},{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>l(()=>import("./NotFound-f7fb3e1d.js"),["assets/NotFound-f7fb3e1d.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/runtime-core.esm-bundler-3e803943.js"])},{path:"/telegram_callback",name:"telegram_auth",component:Q,meta:{layout:"LoadingLayout"}},{path:"/discord_callback",name:"discord_auth",component:X,meta:{layout:"LoadingLayout"}},{path:"/discord_bot_callback",name:"discord_bot_auth",component:Z,meta:{layout:"LoadingLayout"}},{path:"/loading",name:"loading",component:K,meta:{layout:"LoadingLayout"}},{path:"/dashboard",name:"dashboard",meta:{requiresAuth:!0},redirect:()=>{const c=P();return c.user.state=="telegram"?{name:"telegram_dashboard"}:c.user.state=="discord"?{name:"discord_dashboard"}:{path:"/"}}},{path:"/discord",beforeEnter:[te],meta:{requiresAuth:!0},children:[{path:"dashboard",name:"discord_dashboard",component:ee},{path:"guilds/:guild_id/",meta:{layout:"DiscordGuildLayout"},beforeEnter:async(c,o,n)=>{const{useDiscordGuildStore:a}=await l(()=>import("./discordGuild-06178228.js"),["assets/discordGuild-06178228.js","assets/jwt-dc6be0b0.js","assets/runtime-core.esm-bundler-3e803943.js","assets/loadUserGuilds-62d26ffa.js"]),g=a(),u=c.params.guild_id;return u?await g.getGuild(u)?n():n({name:"discord_dashboard"}):n({name:"discord_dashboard"})},children:[{path:"",redirect:{name:"DiscordDashboard"}},{path:"dashboard",name:"DiscordDashboard",component:()=>l(()=>import("./DashboardView-5602c5ed.js"),["assets/DashboardView-5602c5ed.js","assets/discordGuild-06178228.js","assets/jwt-dc6be0b0.js","assets/runtime-core.esm-bundler-3e803943.js","assets/loadUserGuilds-62d26ffa.js","assets/vue-router-1dd73624.js"])},{path:"general",name:"DiscordGuildGeneral",component:()=>l(()=>import("./GeneralView-c2549c22.js"),["assets/GeneralView-c2549c22.js","assets/discordGuild-06178228.js","assets/jwt-dc6be0b0.js","assets/runtime-core.esm-bundler-3e803943.js","assets/loadUserGuilds-62d26ffa.js","assets/DropdownComponent-6b6f811c.js","assets/LoadingComponent-55249104.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/LoadingComponent-9b8775c8.css","assets/DropdownComponent-6ebc8e6c.css","assets/vue-router-1dd73624.js","assets/GeneralView-391348fe.css"])},{path:"moderation",name:"DiscordGuildModeration",component:()=>l(()=>import("./DashboardView-5602c5ed.js"),["assets/DashboardView-5602c5ed.js","assets/discordGuild-06178228.js","assets/jwt-dc6be0b0.js","assets/runtime-core.esm-bundler-3e803943.js","assets/loadUserGuilds-62d26ffa.js","assets/vue-router-1dd73624.js"])},{path:"automoderation",name:"DiscordGuildAutomoderation",component:()=>l(()=>import("./DashboardView-5602c5ed.js"),["assets/DashboardView-5602c5ed.js","assets/discordGuild-06178228.js","assets/jwt-dc6be0b0.js","assets/runtime-core.esm-bundler-3e803943.js","assets/loadUserGuilds-62d26ffa.js","assets/vue-router-1dd73624.js"])},{path:"commands",name:"DiscordGuildCommands",component:()=>l(()=>import("./DashboardView-5602c5ed.js"),["assets/DashboardView-5602c5ed.js","assets/discordGuild-06178228.js","assets/jwt-dc6be0b0.js","assets/runtime-core.esm-bundler-3e803943.js","assets/loadUserGuilds-62d26ffa.js","assets/vue-router-1dd73624.js"])},{path:"features",name:"DiscordGuildFeatures",component:()=>l(()=>import("./DashboardView-5602c5ed.js"),["assets/DashboardView-5602c5ed.js","assets/discordGuild-06178228.js","assets/jwt-dc6be0b0.js","assets/runtime-core.esm-bundler-3e803943.js","assets/loadUserGuilds-62d26ffa.js","assets/vue-router-1dd73624.js"])}]}]},{path:"/telegram",beforeEnter:[re],meta:{requiresAuth:!0},children:[{path:"dashboard",name:"telegram_dashboard",component:()=>l(()=>import("./TelegramDashboard-e0512aae.js"),["assets/TelegramDashboard-e0512aae.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/runtime-core.esm-bundler-3e803943.js"])}]}]});L.beforeResolve(async(c,o,n)=>{if(I.inc(),c.meta.requiresAuth&&!await(await P()).isAuthenticated())return{path:"/"};I.inc(),n()});L.afterEach(()=>{I.done()});export{l as _,I as n,L as r,P as u};
